{{ 'component-newsletter.css' | asset_url | stylesheet_tag }}
{{ 'newsletter-section.css' | asset_url | stylesheet_tag }}
{{ 'subscribe-with-media.out.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% comment %} <div class="newsletter center {% if section.settings.full_width == false %}newsletter--narrow page-width{% endif %}">
  {% if section.settings.video != blank %}
    {{ section.settings.video | video_tag: image_size: '1100x', autoplay: true, loop: true, controls: false, muted: true }}
  {%- endif -%}
  <div class="newsletter__wrapper color-{{ section.settings.color_scheme }} gradient content-container isolate{% if section.settings.full_width %} content-container--full-width{% endif %} section-{{ section.id }}-padding">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when '@app' -%}
          {% render block %}
        {%- when 'logo' -%}
          <div class="subscribe-with-media__logo">
            {% if block.settings.logo != blank %}
              {{ block.settings.logo | image_url: width: 2000 | image_tag: width: imageWidth, height: imageHeight, class: '', sizes: '100vw', widths: '375, 550, 750, 1100, 1500, 1780, 2000' }}
            {% endif %}
          </div>
        {%- when 'heading' -%}
            <h2
              class="inline-richtext {{ block.settings.heading_size }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
              {{ block.shopify_attributes }}
              {% if settings.animations_reveal_on_scroll %}
                data-cascade
                style="--animation-order: {{ forloop.index }};"
              {% endif %}
            >
              {{ block.settings.heading }}
            </h2>
        {%- when 'paragraph' -%}
          <div class="subscribe-with-media__text-container">
            <div
              class="newsletter__subheading rte{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
              {{ block.shopify_attributes }}
              {% if settings.animations_reveal_on_scroll %}
                data-cascade
                style="--animation-order: {{ forloop.index }};"
              {% endif %}
            >
              {{ block.settings.text }}
            </div>
          </div>
        {%- when 'email_form' -%}
          <div {{ block.shopify_attributes }}>
            {% form 'customer', class: 'newsletter-form' %}
              <input type="hidden" name="contact[tags]" value="newsletter">
              <div
                class="newsletter-form__field-wrapper{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                {% if settings.animations_reveal_on_scroll %}
                  data-cascade
                  style="--animation-order: {{ forloop.index }};"
                {% endif %}
              >
                <div class="field field-email">
                  <input
                    id="NewsletterForm--{{ section.id }}"
                    type="email"
                    name="contact[email]"
                    class="field__input"
                    value="{{ form.email }}"
                    aria-required="true"
                    autocorrect="off"
                    autocapitalize="off"
                    autocomplete="email"
                    {% if form.errors %}
                      autofocus
                      aria-invalid="true"
                      aria-describedby="Newsletter-error--{{ section.id }}"
                    {% elsif form.posted_successfully? %}
                      aria-describedby="Newsletter-success--{{ section.id }}"
                    {% endif %}
                    placeholder="{{ 'newsletter.label' | t }}"
                    required
                  >
                  <label class="field__label" for="NewsletterForm--{{ section.id }}">
                    {{ 'newsletter.label' | t }}
                  </label>
                </div>
                <div class="field">
                  <select
                    name="contact[country]"
                    id="NewsletterForm-country-{{ section.id }}"
                    value="{{ form.country }}"
                    class="field__input"
                    {% if form.errors %}
                      autofocus
                      aria-invalid="true"
                      aria-describedby="Newsletter-error--{{ section.id }}"
                    {% elsif form.posted_successfully? %}
                      aria-describedby="Newsletter-success--{{ section.id }}"
                    {% endif %}
                    placeholder="{{ 'newsletter.label' | t }}"
                  >
                    <option value="Australia">Australia</option>
                    <option value="Japan">Japan</option>
                    <option value="USA">USA</option>
                    <option value="Netherlands">Netherlands</option>
                  </select>

                  <label class="field__label" for="NewsletterForm-country-{{ section.id }}">
                    {{ section.settings.select_1_label }}
                  </label>
                </div>
                <div class="field">
                  <select
                    name="contact[heard_about_us]"
                    id="NewsletterForm-heard_about_us-{{ section.id }}"
                    value="{{ form.heard_about_us }}"
                    class="field__input"
                    {% if form.errors %}
                      autofocus
                      aria-invalid="true"
                      aria-describedby="Newsletter-error--{{ section.id }}"
                    {% elsif form.posted_successfully? %}
                      aria-describedby="Newsletter-success--{{ section.id }}"
                    {% endif %}
                    placeholder="{{ 'newsletter.label' | t }}"
                  >
                    <option value="Spannabis">Spannabis</option>
                    <option value="CWCBE">CWCBE</option>
                    <option value="CannaCon">CannaCon</option>
                    <option value="Google">Google</option>
                    <option value="Other">Other</option>
                  </select>

                  <label class="field__label" for="NewsletterForm-heard_about_us-{{ section.id }}">
                    {{ section.settings.select_2_label }}
                  </label>
                </div>
                {%- if form.errors -%}
                  <small class="newsletter-form__message form__message" id="Newsletter-error--{{ section.id }}">
                    <span class="svg-wrapper">
                      {{- 'icon-error.svg' | inline_asset_content -}}
                    </span>
                    {{- form.errors.translated_fields.email | capitalize }}
                    {{ form.errors.messages.email -}}
                  </small>
                {%- endif -%}
              </div>
              <button
                type="submit"
                class="newsletter-form__button field__button"
                name="commit"
                id="Subscribe"
                aria-label="{{ 'newsletter.button_label' | t }}"
              >
                 Submit
              </button>
              {%- if form.posted_successfully? -%}
                <h3
                  class="newsletter-form__message newsletter-form__message--success form__message"
                  id="Newsletter-success--{{ section.id }}"
                  tabindex="-1"
                  autofocus
                >
                  <span class="svg-wrapper">
                    {{- 'icon-success.svg' | inline_asset_content -}}
                  </span>
                  {{- 'newsletter.success' | t }}
                </h3>
              {%- endif -%}
              {% if form.errors %}
                <p style="color: red;">Ошибка отправки: {{ form.errors | json }}</p>
              {% endif %}
              
              {% if form.posted_successfully? %}
                <p style="color: green;">Форма успешно отправлена!</p>
              {% endif %}
            {% endform %}
          </div>
      {%- endcase -%}
    {%- endfor -%}
  </div>
</div> {% endcomment %}

<div class="customer register section-{{ section.id }}-padding"
 x-data="{form: document.querySelector('#create_customer'),
          vat: '',
          vatUpdate: '',
          website: '',
          websiteUpdate: '',
          error: false,
          names: false,
          tags: false,
          store: '',
          storeUpdate: '',
          phone: '',
          phoneUpdate: '',
          first: '',
          last: '',

          checkForm(){
            if (this.vat != '' && this.website != '' && this.store != '' && this.phone != ''){
              this.tags = false;
              if (this.first == '' || this.last == ''){
                this.error = true;
                this.names = true;
                window.scrollTo({ top: 0, behavior: 'smooth' });
              } else {
                this.error = false;
                this.names = false;
                this.tags = false;
                this.$refs.vatUpdate.value = 'VAT Number: ' + this.vat;
                this.$refs.websiteUpdate.value = 'Website: ' + this.website;
                this.$refs.storeUpdate.value = 'Store Name: ' + this.store;
                this.$refs.phoneUpdate.value = 'Phone: ' + this.phone;
                this.form.submit();
              } 
            } else {
              this.error = true;
              this.tags = true;
              window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
          }
 
        }"
  x-init="this.form = document.querySelector('#create_customer')"
 >
 <h1 id="register">
  {{ 'customer.register.title' | t }}
 </h1>
 {%- form 'create_customer', novalidate: 'novalidate' -%}
  {%- if form.errors -%}
   <h3 class="form__message" tabindex="-1">
    <svg aria-hidden="true" focusable="false" viewBox="0 0 13 13">
     <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
     <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
     <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
     <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
    </svg>
    {{ 'templates.contact.form.error_heading' | t }}
   </h3>
   <ul>
    {%- for field in form.errors -%}
     <li>
      {%- if field == 'form' -%}
       {{ form.errors.messages[field] }}
      {%- else -%}
       <a href="#RegisterForm-{{ field }}">
        {{ form.errors.translated_fields[field] | capitalize }}
        {{ form.errors.messages[field] }}
       </a>
      {%- endif -%}
     </li>
    {%- endfor -%}
   </ul>
  {%- endif -%}
  <div x-show="error" style="display: none;"><h3 class="form__message">
    <svg aria-hidden="true" focusable="false" viewBox="0 0 13 13">
     <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
     <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
     <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
     <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
    </svg>
    {{ 'templates.contact.form.error_heading' | t }}
   </h3>
   <ul>
     <li x-show="tags">
      {{ 'templates.contact.form.error_tags' | t }}
     </li>
     <li x-show="names">
      {{ 'templates.contact.form.error_names' | t }}
     </li>
   </ul></div>
  
  <div>

    <input
      type="hidden"
      name="customer[tags][0]"
      value=""
      x-ref="vatUpdate"
    >
    <input
      type="hidden"
      name="customer[tags][1]"
      value=""
      x-ref="websiteUpdate"
    >
    <input
      type="hidden"
      name="customer[tags][2]"
      value=""
      x-ref="storeUpdate"
    >
    <input
      type="hidden"
      name="customer[tags][3]"
      value=""
      x-ref="phoneUpdate"
    >
  <div class="information-wrapper">
    <div class="information-wrapper__title">{{ 'templates.contact.form.personal_info' | t }}</div>
    <div class="field">
      <input
        type="text"
        name="customer[first_name]"
        x-model="first"
        requaired
        id="RegisterForm-FirstName"
        {% if form.first_name %}
        value="{{ form.first_name }}"
        {% endif %}
        autocomplete="given-name"
        placeholder="{{ 'customer.register.first_name' | t }}"
      >
  </div>
  <div class="field">
   <input
    type="text"
    x-model="last"
    name="customer[last_name]"
    requaired
    id="RegisterForm-LastName"
    {% if form.last_name %}
     value="{{ form.last_name }}"
    {% endif %}
    autocomplete="family-name"
    placeholder="{{ 'customer.register.last_name' | t }}"
   >
  </div>
  <div class="field">
   <input
    type="text"
    name="customer[vat]"
    id="RegisterForm-VAT"
    x-model="vat"
    value=""
    requaired
    placeholder="{{ 'customer.register.tax' | t }}"
   >
  </div>
  <div class="field">
      <input
        type="text"
        name="customer[phone]"
        x-model="phone"
        requaired
        id="RegisterForm-Phone"
        value=""
        placeholder="{{ 'customer.register.phone' | t }}"
      >
  </div>
  </div>
  
  <div class="information-wrapper">
    <div class="information-wrapper__title">{{ 'templates.contact.form.sign_info' | t }}</div>
    <div class="field">
      <input
       type="email"
       name="customer[email]"
       id="RegisterForm-email"
       spellcheck="false"
       autocapitalize="off"
       autocomplete="email"
       aria-required="true"
       placeholder="{{ 'customer.register.email' | t }}"
      >
     </div>
     <div class="field">
      <input
       type="password"
       name="customer[password]"
       id="RegisterForm-password"
       aria-required="true"
       placeholder="{{ 'customer.register.password' | t }}"
      >
     </div>
  </div>
  <div class="information-wrapper">
    <div class="information-wrapper__title">{{ 'templates.contact.form.store_info' | t }}</div>
    <div class="field">
      <input
        type="text"
        name="customer[website]"
        id="RegisterForm-Website"
        x-model="website"
        value=""
        requaired
        placeholder="{{ 'customer.register.website' | t }}"
      >
    </div>
    <div class="field">
    <input
      type="text"
      name="customer[store]"
      id="RegisterForm-store"
      x-model="store"
      value=""
      requaired
      placeholder="{{ 'customer.register.store' | t }}"
    >
    </div>
  </div>
  
  <button class="button__black" @click.prevent="checkForm">
   {{ 'customer.register.submit' | t }}
  </button>
 {%- endform -%}
</div>

{% schema %}
{
  "name": "Subscribe with media",
  "tag": "section",
  "class": "section subscribe-with-media",
  "disabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "video",
      "id": "video",
      "label": "t:sections.video.settings.video.label"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": true,
      "label": "t:sections.newsletter.settings.full_width.label"
    },
    {
      "type": "paragraph",
      "content": "t:sections.newsletter.settings.paragraph.content"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 52
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Logo"
        }
      ]
    },
    {
      "type": "heading",
      "name": "t:sections.newsletter.blocks.heading.name",
      "limit": 1,
      "settings": [
        {
          "type": "inline_richtext",
          "id": "heading",
          "default": "t:sections.newsletter.blocks.heading.settings.heading.default",
          "label": "t:sections.newsletter.blocks.heading.settings.heading.label"
        },
        {
          "type": "inline_richtext",
          "id": "select_1_label",
          "default": "Your country",
          "label": "Select label 1"
        },
        {
          "type": "inline_richtext",
          "id": "select_2_label",
          "default": "Heard about us",
          "label": "Select label 2"
        },
        {
          "type": "select",
          "id": "heading_size",
          "options": [
            {
              "value": "h2",
              "label": "t:sections.all.heading_size.options__1.label"
            },
            {
              "value": "h1",
              "label": "t:sections.all.heading_size.options__2.label"
            },
            {
              "value": "h0",
              "label": "t:sections.all.heading_size.options__3.label"
            },
            {
              "value": "hxl",
              "label": "t:sections.all.heading_size.options__4.label"
            },
            {
              "value": "hxxl",
              "label": "t:sections.all.heading_size.options__5.label"
            }
          ],
          "default": "h1",
          "label": "t:sections.all.heading_size.label"
        }
      ]
    },
    {
      "type": "paragraph",
      "name": "t:sections.newsletter.blocks.paragraph.name",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "default": "t:sections.newsletter.blocks.paragraph.settings.paragraph.default",
          "label": "t:sections.newsletter.blocks.paragraph.settings.paragraph.label"
        }
      ]
    },
    {
      "type": "email_form",
      "name": "t:sections.newsletter.blocks.email_form.name",
      "limit": 1
    },
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "Subscribe with media",
      "blocks": [
        {
          "type": "heading"
        },
        {
          "type": "paragraph"
        },
        {
          "type": "email_form"
        }
      ]
    }
  ]
}
{% endschema %}
